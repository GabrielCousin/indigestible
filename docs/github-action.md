# GitHub Action - Newsletter Digest

## Overview

The Newsletter Digest GitHub Action automatically fetches newsletters and creates a GitHub issue with the aggregated content. This provides an easy way to review all newsletters in one place directly in your repository.

## Features

- üïê **Scheduled Execution**: Runs automatically every Monday at 8AM Paris time
- üöÄ **Manual Trigger**: Can be triggered manually via workflow_dispatch
- üìù **Issue Creation**: Creates a formatted GitHub issue with all newsletter content
- üì¶ **Artifact Upload**: Saves raw output files as workflow artifacts
- üè∑Ô∏è **Auto-labeling**: Issues are tagged with `newsletter` and `automated` labels
- üìä **Table of Contents**: Generated issue includes a navigable TOC

## Schedule

The workflow runs on a schedule:
- **Cron**: `0 6 * * 1` (6:00 AM UTC)
- **Paris Time**: 8:00 AM in winter (CET), 7:00 AM in summer (CEST)
- **Day**: Every Monday

## Manual Trigger

You can manually trigger the workflow at any time:

1. Go to the **Actions** tab in your GitHub repository
2. Select **Newsletter Digest** from the workflows list
3. Click **Run workflow** button
4. Select the branch (usually `main` or `master`)
5. Click **Run workflow**

## Setup Requirements

### 1. GitHub Permissions

The workflow requires the following permissions:
- **issues: write** - To create issues
- **contents: read** - To read the repository code

These are automatically granted via the `GITHUB_TOKEN`.

### 2. OpenAI API Key (Required for AI Summary)

The workflow uses OpenAI to generate an AI-curated summary of the newsletters. You need to add your OpenAI API key as a GitHub secret:

1. Go to your repository **Settings**
2. Navigate to **Secrets and variables** ‚Üí **Actions**
3. Click **New repository secret**
4. Name: `OPENAI_API_KEY`
5. Value: Your OpenAI API key (starts with `sk-`)
6. Click **Add secret**

**Without this secret**, the workflow will fail at the AI summary generation step. Make sure you have:
- An OpenAI account
- API access enabled
- Sufficient credits/quota

The AI model used is configured in `config.yaml` (default: `gpt-5-nano`).

## Issue Format

Each generated issue includes:

### Header
- Issue title: `ü§ñ AI Newsletter Digest - [Date]` (or `üì∞ Newsletter Digest - [Date]` if AI summary fails)
- Brief description noting it's an AI-curated summary

### AI-Curated Summary (Primary Content)
- **Organized by topic** (React, JavaScript, Updates, Tools, Design, etc.)
- **Duplicate removal** - Same news from multiple sources merged
- **Sponsor filtering** - Ads and promotional content removed
- **Clean formatting** - Links cleaned, tracking parameters removed
- **Context preserved** - Each item includes relevant details and source links

### Raw Newsletter Content (Collapsible)
- Full raw content from all newsletters
- Nested collapsible sections for each source
- Useful for reference or if you want to see the original content
- Each newsletter in a separate expandable section

### Footer
- Generation timestamp
- Link back to the repository

## Example Issue Structure

```markdown
# ü§ñ Weekly Newsletter Digest (AI Summary)

This is an AI-curated summary of this week's newsletters, organized by topic.

---

## üî∑ React

**React 19.2 Release**
- Includes new View Transitions API support
- Added useEffectEvent() hook for better event handling
- [Source: Next.js Weekly](https://nextjs.org/blog/next-16-beta)

**React Compiler Now Stable**
- Automatic memoization without useMemo/useCallback
- Significant performance improvements
- [Source: This Week in React](https://thisweekinreact.com/newsletter/254)

## üíª JavaScript

**Bun 1.3 Released**
- Full-stack JavaScript runtime
- Drop-in Node.js replacement
- New server capabilities
- [Source: JavaScript Weekly](https://bun.sh)

[... more organized content ...]

---

## üìÑ Raw Newsletter Content

<details>
<summary>Click to view full raw content from all newsletters</summary>

### Console.dev
<details>
<summary>Expand Console.dev</summary>
[Full raw content...]
</details>

### Web Weekly
<details>
<summary>Expand Web Weekly</summary>
[Full raw content...]
</details>

</details>

---

*This digest was automatically generated by the Newsletter Aggregator.*
*Generated on: 2025-10-21 06:00:00 UTC*
```

## Workflow Steps

1. **Checkout**: Clones the repository
2. **Setup**: Installs uv and Python 3.12
3. **Install**: Syncs project dependencies
4. **Fetch**: Runs the newsletter aggregator script (`src/main.py`)
5. **AI Summary**: Generates AI-curated summary using OpenAI (`src/summarize.py`)
6. **Check**: Verifies output was generated
7. **Prepare**: Formats content for the issue (uses AI summary if available)
8. **Create**: Posts the issue to GitHub
9. **Archive**: Uploads all output files as workflow artifacts

## Customization

### Change Schedule

Edit the cron expression in `.github/workflows/newsletter-digest.yml`:

```yaml
schedule:
  - cron: '0 6 * * 1'  # Minute Hour Day Month DayOfWeek
```

Examples:
- Every day at 8AM: `0 6 * * *`
- Every Wednesday at 9AM: `0 7 * * 3`
- Twice a week (Mon & Thu): `0 6 * * 1,4`

### Change Issue Labels

Modify the labels in the script section:

```javascript
labels: ['newsletter', 'automated', 'your-custom-label']
```

### Change Issue Title Format

Edit the title template in the script section:

```javascript
title: `üì∞ Newsletter Digest - ${dateStr}`,
```

## Troubleshooting

### Issue Not Created

**Check if:**
1. The workflow ran successfully (check Actions tab)
2. Output files were generated in the `output/` directory
3. The bot has permission to create issues
4. Labels exist in your repository (create them if missing)

### Content Not Showing

**Check if:**
1. Newsletters are enabled in `config.yaml`
2. The fetcher script completed successfully
3. Output files contain content (check artifacts)

### Schedule Not Working

**Check if:**
1. The workflow file is on your default branch
2. Actions are enabled for your repository
3. The repository is not archived

### Manual Trigger Not Available

**Check if:**
1. The workflow file has `workflow_dispatch:` trigger
2. You have push/write access to the repository
3. The workflow file syntax is valid

## Viewing Artifacts

If you want to access the raw markdown files:

1. Go to the **Actions** tab
2. Click on a completed workflow run
3. Scroll to **Artifacts** section
4. Download **newsletter-output.zip**
5. Extract and view the individual markdown files

Artifacts are retained for 30 days by default.

## Integration with Issues

The created issues can be:
- Assigned to team members for review
- Commented on for discussion
- Closed when reviewed
- Searched using GitHub's issue search
- Filtered by labels
- Referenced in other issues or PRs

## Cost Considerations

GitHub Actions minutes:
- Public repositories: Free unlimited minutes
- Private repositories: Free tier includes 2,000 minutes/month

This workflow typically uses:
- ~2-5 minutes per run
- ~4 runs per month (weekly)
- Total: ~8-20 minutes per month

## Security Notes

- The workflow uses `GITHUB_TOKEN` which is automatically provided
- No additional secrets or API keys are exposed
- The token has minimal permissions (read contents, write issues)
- Newsletter fetching uses standard HTTP requests

## Future Enhancements

Possible improvements:
- Add email notifications when issue is created
- Generate a summary using AI before creating the issue
- Compare with previous week's content
- Track trending topics across newsletters
- Create a dashboard view
- Post to Slack/Discord instead of/in addition to issues
